<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GovCon AI Chat</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh; display: flex; flex-direction: column;
        }
        #chat-container { flex: 1; display: flex; flex-direction: column; max-width: 100%; margin: 0 auto; background: white; height: 100vh; }
        #chat-header {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white; padding: 20px; text-align: center;
        }
        #chat-header h1 { font-size: 1.5rem; font-weight: 600; }
        #chat-messages { flex: 1; overflow-y: auto; padding: 20px; background: #f9fafb; }
        .message { margin-bottom: 16px; display: flex; gap: 12px; }
        .message.user { flex-direction: row-reverse; }
        .message-avatar {
            width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 14px;
        }
        .message.assistant .message-avatar { background: #e5e7eb; color: #374151; }
        .message.user .message-avatar { background: #3b82f6; color: white; }
        .message-content {
            max-width: 80%; padding: 12px 16px; border-radius: 12px; font-size: 14px; line-height: 1.5;
        }
        .message.assistant .message-content { background: white; border: 1px solid #e5e7eb; border-top-left-radius: 4px; }
        .message.user .message-content { background: #3b82f6; color: white; border-top-right-radius: 4px; }
        #chat-input-container { padding: 16px; background: white; border-top: 1px solid #e5e7eb; }
        #chat-input-form { display: flex; gap: 8px; }
        #chat-input {
            flex: 1; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; outline: none;
        }
        #chat-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        #send-button {
            padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background 0.2s;
        }
        #send-button:hover { background: #2563eb; }
        #send-button:disabled { background: #d1d5db; cursor: not-allowed; }
        .loading { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #3b82f6; animation: bounce 1.4s infinite ease-in-out both; }
        .loading:nth-child(1) { animation-delay: -0.32s; }
        .loading:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="chat-header">
            <h1>ðŸ¤– GovCon AI Assistant</h1>
            <p style="font-size: 14px; opacity: 0.9; margin-top: 4px;">Ask about SAM.gov, NAICS codes, FEMA opportunities & more</p>
        </div>
        <div id="chat-messages">
            <div class="message assistant">
                <div class="message-avatar">ðŸ¤–</div>
                <div class="message-content">
                    Hi! I'm your GovCon AI assistant. I can help you with:<ul style="margin-top: 8px; margin-left: 20px;">
                        <li>SAM.gov opportunities</li>
                        <li>NAICS codes & set-asides</li>
                        <li>FEMA contract intelligence</li>
                        <li>Proposal strategies</li>
                    </ul>What would you like to know?
                </div>
            </div>
        </div>
        <div id="chat-input-container">
            <form id="chat-input-form">
                <input type="text" id="chat-input" placeholder="Ask about government contracts..." autocomplete="off">
                <button type="submit" id="send-button">Send</button>
            </form>
            <p style="font-size: 12px; color: #6b7280; text-align: center; margin-top: 8px;">Powered by Claude AI (Real-time)</p>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const chatForm = document.getElementById('chat-input-form');

        if (!chatMessages || !chatInput || !sendButton || !chatForm) {
            console.error('Chat elements not found in DOM');
            return;
        }

        // Demo responses for different topics
        const responses = {
            'govcon': "GovCon AI is an intelligent platform that monitors SAM.gov 24/7, tracking government contract opportunities across NAICS codes, FEMA programs, and State EMA contracts. We deliver real-time alerts to your Slack and email before your competitors even start searching.",
            'sam': "SAM.gov is the official U.S. government system for contract opportunities. We monitor it continuously and filter opportunities based on your NAICS codes, set-asides (8(a), HUBZone, SDVOSB, WOSB), and keywords. You'll get instant notifications when relevant contracts are posted.",
            'naics': "NAICS (North American Industry Classification System) codes categorize business activities. For government contracting, choosing the right NAICS codes is crucial as contracts are often set aside for specific codes. We track 13 primary NAICS codes relevant to government contracting and emergency management.",
            'fema': "FEMA contracts provide opportunities for disaster response, emergency management, and recovery services. We track FEMA opportunities as well as State Emergency Management Agency (EMA) contracts across all 50 states, giving you a competitive advantage.",
            'price': "We offer flexible pricing starting at $49/month for basic monitoring, up to enterprise plans with custom NAICS tracking, dedicated Slack channels, and priority alerts. Contact us at support@govconcommandcenter.com for a demo!",
            'start': "Getting started is easy! Sign up for a free 14-day trial, connect your Slack workspace, select your NAICS codes and keywords, and start receiving real-time contract alerts. No credit card required for the trial.",
            'default': "That's a great question! GovCon AI specializes in government contract intelligence. We can help you with SAM.gov opportunities, NAICS codes, FEMA contracts, proposal strategies, and more. What specific area would you like to know about?"
        };

        function getResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            if (msg.includes('govcon') || msg.includes('what is') || msg.includes('about')) return responses.govcon;
            if (msg.includes('sam.gov') || msg.includes('sam ')) return responses.sam;
            if (msg.includes('naics')) return responses.naics;
            if (msg.includes('fema')) return responses.fema;
            if (msg.includes('price') || msg.includes('cost') || msg.includes('pricing')) return responses.price;
            if (msg.includes('start') || msg.includes('sign up') || msg.includes('trial')) return responses.start;
            return responses.default;
        }

        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            await sendMessage();
        });

                async function sendMessage() {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            addMessage('user', userMessage);
            chatInput.value = '';
            sendButton.disabled = true;
            addLoadingMessage();

            try {
                // Call the real API endpoint
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: userMessage
                    })
                });

                removeLoadingMessage();

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                addMessage('assistant', data.content);

            } catch (error) {
                removeLoadingMessage();
                console.error('Chat error:', error);
                addMessage('assistant', "I'm having trouble connecting to the AI service. Please try again or contact support@govconcommandcenter.com");
            } finally {
                sendButton.disabled = false;
                chatInput.focus();
            }
        }, 800);
        }

        let messages = [];

        function addMessage(role, content) {
            messages.push({ role, content });
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = role === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addLoadingMessage() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message assistant';
            messageDiv.id = 'loading-message';
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'ðŸ¤–';
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = '<span class="loading"></span> <span class="loading"></span> <span class="loading"></span>';
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoadingMessage() {
            const loading = document.getElementById('loading-message');
            if (loading) loading.remove();
        }

        chatInput.focus();
        console.log('Chatbot initialized');
    });
    </script>
</body>
</html>